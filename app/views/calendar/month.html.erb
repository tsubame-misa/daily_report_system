<%# カレンダーのヘッダー部分 %>
<div class="user-calendar-container mb-4">
  <div class="user-calendar-header">
    <h2 class="text-center"><%= @selected_year %>年 <%= @selected_month %>月</h2>
    <div class="navigation-buttons">
      <%= link_to '前月', calendar_month_path(date: @prev_month), class: 'btn btn-outline-primary' %>
      <%= link_to '次月', calendar_month_path(date: @next_month), class: 'btn btn-outline-primary' %>
    </div>
  </div>

  <%# カレンダー本体 %>
  <table class="user-calendar">
    <thead>
      <tr>
        <th class="text-center">日</th>
        <th class="text-center">月</th>
        <th class="text-center">火</th>
        <th class="text-center">水</th>
        <th class="text-center">木</th>
        <th class="text-center">金</th>
        <th class="text-center">土</th>
      </tr>
    </thead>
    <tbody>
      <% @calendar_weeks.each do |week| %>
        <tr>
          <% week.each do |date| %>
            <% if date.nil? %>
              <td class="text-center empty-cell"></td>
            <% else %>
              <% has_report = @report_dates[date].present? %>
              <td class="text-center <%= 'has-report' if has_report %>">
                <% if has_report %>
                  <%= link_to date.day, report_path(@report_dates[date]), class: 'report-date' %>
                <% else %>
                  <%= link_to date.day, new_report_path(date: date.strftime('%Y-%m-%d')), class: 'new-report-date' %>
                <% end %>
              </td>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%# 最近の日報セクション %>
<div class="recent-reports-container">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">最近の日報</h5>
      <%= link_to '日報一覧へ', reports_path, class: 'btn btn-outline-primary btn-sm' %>
    </div>
    <div class="list-group list-group-flush">
      <% if @recent_reports.any? %>
        <% @recent_reports.each do |report| %>
          <%= link_to report_path(report), class: 'list-group-item list-group-item-action' do %>
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1"><%= report.title %></h6>
              <small class="text-muted"><%= l report.report_date, format: :long %></small>
            </div>
            <p class="mb-1 text-truncate"><%= report.contents.truncate(100) %></p>
          <% end %>
        <% end %>
      <% else %>
        <div class="list-group-item text-center text-muted">
          日報がまだありません
        </div>
      <% end %>
    </div>
  </div>
</div>
